<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    xmlns:v-on="http://vuejs.org"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="cshm.content">


<body>
<metal:content-core fill-slot="content-core">
<metal:content-core define-macro="content-core"
                    tal:define="toc context/table_of_contents|nothing;">
<link rel="stylesheet" href="++theme++theme-for-cshm/css/c3.min.css" />

<style>
input{
    width: 20% !important;
    display: inline !important;
    margin-bottom: 15px;
}
td,th{
    text-align: center;
    padding: 5px 0;
}
td{
    font-size: 17px;
}
th{
    font-size: 20px;
}
#course1, #course2{
    height: unset;
    padding: 8px 5px;
    font-size: 17px;
    float: none;
}
input[type='number']{
    min-width: 200px;
    background-color: #fff;
    border: 1px solid #e5e5e5;
    line-height: 250%;
    padding: 0px 10px;
    height: unset;
    border-radius: 3px;
}
</style>
<?python
from plone import api
abs_url = api.portal.get().absolute_url()
?>
<button id='back' style='margin-bottom:20px' 
   onclick="backFolderContents()">回目錄</button>
<br/>
訓前
<select name="course" id="course1">
    <option value="職業安全衛生管理員">職業安全衛生管理員 </option>
    <option value="荷重再一噸以上之堆高機操作人員">荷重再一噸以上之堆高機操作人員</option>
    <option value="丙種職業安全衛生業務主管">丙種職業安全衛生業務主管</option>
    <option value="急救人員">急救人員</option>
</select>

期數 <input type="number" id="period1"  />

<button class='send' id='send1' data-target="1"  >送出</button>
<br>

滿意度
<select id="course2">
    <option tal:repeat="item view/result" value="${python: item[1]}">${python:item[0]}</option>
</select>
期數 <input type="number" id="period2"  />
<button class='send' id='send2'  data-target="2" >送出</button>

<div id="result"></div>

<script>
function backFolderContents(){
        location.href = location.href.replace('show_satisfaction_statistics', 'folder_contents')
}
document.getElementById('send2').addEventListener('click', function(event){  
    target = event.currentTarget.dataset['target']
    period = document.querySelector('#period' + target).value
    course = document.querySelector('#course' + target).value

    if(period == ''){
        alert('請填寫期數')
        return false
    }
    if(target == 2){
        url = location.href.replace('show_satisfaction_statistics', 'calculate_satisfaction')
    }
    else if(target == 1){
        url = location.href.replace('show_satisfaction_statistics', 'calculate_training')
    }

    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function(rep) {
        if (this.readyState == 4 && this.status == 200) {
            document.getElementById('result').innerHTML = this.response
            var s = document.createElement('script');
            s.src = '++theme++theme-for-cshm/js/drawPie.js'
            document.body.appendChild(s);
        }
    };
    xhttp.open("POST", url, true);
    var data = new FormData();
    data.append('period', period);
    data.append('course', course);
    xhttp.send(data);
})
</script>
<script src="++theme++theme-for-cshm/js/d3.v3.min.js"></script>
<script src="++theme++theme-for-cshm/js/c3.min.js"></script>

</metal:content-core>
</metal:content-core>


</body>
</html>

