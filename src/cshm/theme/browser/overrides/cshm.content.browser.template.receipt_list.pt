<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    xmlns:v-bind="http://www.vue.org/v-bind"
    xmlns:v-on="http://www.vue.org/v-bind"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="cshm.content">
<body>

<metal:javascriptslot fill-slot="javascript_head_slot">
</metal:javascriptslot>

<metal:content-core fill-slot="content-core">
<metal:content-core define-macro="content-core"
                    tal:define="toc context/table_of_contents|nothing;">
<style>
.btn_group li.selected {
    background-color: #07689f;
}
.btn_group>li {
    display: inline-block;
    padding: 8px 10px;
    color: #fff;
    background-color: #545b62;
    border-color: #4e555b;
    border-radius: 8px;
    margin-bottom: 20px;
    cursor: pointer;
    margin-right: 5px;
</style>

<ul class='btn_group'>
  <li data-action="create">批次建立收據</li>
</ul>

<tal:condition condition="view/admit">
  <table>
    <tr>
      <td>單位</td>
      <td>座號</td>
      <td>姓名</td>
      <td>金額</td>
      <td>轉出</td>
      <td>保留轉出</td>
      <td>刪除</td>
      <td>收據輔助</td>
      <td>報名表</td>
    </tr>
    <tr tal:repeat="item python: view.admit">
      <tal:def define="dict python: dict(item)">
        <td>${python: dict['company_name']}</td>
        <td>${python: dict['seatNo']}</td>
        <td>${python: dict['name']}</td>
        <td>TODO</td>
        <td>TODO</td>
        <td>TODO</td>
        <td>TODO</td>
        <td>
          <a href="${python: view.context.absolute_url()}/@@receipt_create_view?userList=${python: dict['id']}">建立收據</a>
          <input type="checkbox" data-user_id="${python: dict['id']}">
        </td>
        <td>TODO</td>
      </tal:def>
    </tr>
  </table>
<tal:condition>

<tal:condition condition="not: view/admit">
  <h1>No Data</h1>
</tal:condition>

<script>
$(function(){
    $(".btn_group li").click(function(){
        action = $(this).data()["action"]
        data = {}
        if(action == "create"){
            userList = []
	    $('input[type="checkbox"]:checked').each(function(){
                user_id = $(this).data()["user_id"]
                userList.push(user_id)
            })
            data['userList'] = userList
            url = location.href.replace("receipt_list", "receipt_create_view")
            url += '?userList=' + JSON.stringify(userList)
            window.open(url)
        }
    })
})
</script>

</metal:content-core>
</metal:content-core>

</body>
</html>
